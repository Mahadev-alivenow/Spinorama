import{l as d}from"./index-CRk6jtUA.js";import"./_commonjsHelpers-gnU0ypJ3.js";var c={};async function u(o,e){if(e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","POST, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type"),e.setHeader("Content-Type","application/json"),e.setHeader("Cache-Control","no-store, max-age=0"),o.method==="OPTIONS")return e.status(200).end();if(o.method!=="POST")return e.status(405).json({error:"Method not allowed",timestamp:new Date().toISOString()});try{const a=c.MONGODB_URI;if(!a)return e.status(500).json({error:"MongoDB URI is not defined in environment variables",timestamp:new Date().toISOString()});const t=o.body;if(!t||!t.id)return e.status(400).json({error:"Invalid campaign data - missing required fields",timestamp:new Date().toISOString()});console.log("Direct Campaign Save: Attempting to save campaign:",t.id);const i=new d.MongoClient(a,{maxPoolSize:10,serverSelectionTimeoutMS:5e3,socketTimeoutMS:45e3,retryWrites:!0,retryReads:!0});await i.connect();const r=i.db("wheel-of-wonders").collection("campaigns"),s=await r.findOne({id:t.id});let n;return s?(n=await r.updateOne({id:t.id},{$set:{...t,updatedAt:new Date().toISOString()}}),console.log(`Direct Campaign Save: Updated campaign ${t.id}, matched: ${n.matchedCount}, modified: ${n.modifiedCount}`)):(n=await r.insertOne({...t,createdAt:t.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log(`Direct Campaign Save: Created new campaign ${t.id}, inserted ID: ${n.insertedId}`)),await i.close(),e.status(200).json({success:!0,campaign:t,operation:s?"updated":"created",timestamp:new Date().toISOString()})}catch(a){return console.error("Direct Campaign Save: Error saving campaign:",a),e.status(500).json({error:a.message,stack:a.stack,timestamp:new Date().toISOString()})}}export{u as default};
