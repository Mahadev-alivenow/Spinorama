import{j as e}from"./jsx-runtime-DlxonYWr.js";import{r as o}from"./index-BWtVRBRF.js";import{N as S}from"./Navigation-Rq2-uA4h.js";import{u as B}from"./PlanContext-BY9hTbym.js";import{b as T}from"./index-DjMk7jIJ.js";import{a as U,f as H}from"./components-CJ4Us95c.js";import"./_commonjsHelpers-gnU0ypJ3.js";import"./index-Crcs4hqE.js";const y={MONTHLY:"Monthly Plan",ANNUAL:"Annual Plan"},L=d=>`$${d.toFixed(2)}`;function Z(){var k;const d=T(),t=U(),{billingCycle:l,changeBillingCycle:x,changePlan:u,currentPlan:c}=B(),n=H(),[F,b]=o.useState(!1),[a,A]=o.useState(null),[g,j]=o.useState(!1),[v,p]=o.useState(null),[P,N]=o.useState(null),w=(t==null?void 0:t.availablePlans)||[],m=t==null?void 0:t.isAuthenticated,r=t==null?void 0:t.activeSubscription,f=t==null?void 0:t.shop,C=s=>{x(s)},I=s=>{if(!m){p("Please authenticate first to change plans");return}c.id!==s&&(A(s),b(!0))},M=(s,i)=>s.id==="starter"?null:i==="yearly"?s.shopifyYearlyPlanId||y.ANNUAL:s.shopifyPlanId||y.MONTHLY,$=async()=>{if(a){j(!0),p(null),N(null);try{const s=w.find(h=>h.id===a);if(!s)throw new Error("Selected plan not found");console.log("Confirming plan change to:",a);const i=new FormData;if(i.append("planId",a),i.append("billingCycle",l),a!=="starter"){const h=M(s,l);console.log("Adding billing info for paid plan:",h),i.append("shopifyPlanName",h),i.append("returnUrl",`${window.location.origin}/app?shop=${f}`),i.append("isTest","true")}else console.log("Free plan selected - no billing required");n.submit(i,{method:"post"})}catch(s){console.error("Subscription change error:",s),p(s.message||"Failed to change subscription"),j(!1),b(!1)}}};o.useEffect(()=>{n.data&&(console.log("Fetcher response:",n.data),n.data.success?(u(n.data.planId),n.data.confirmationUrl?(N("Redirecting to Shopify to confirm your subscription..."),setTimeout(()=>{window.top.location.href=n.data.confirmationUrl},2e3)):(N(n.data.message||"Plan updated successfully!"),setTimeout(()=>{d(`/app?shop=${f}`)},2e3))):p(n.data.message||"Failed to change subscription"),j(!1),b(!1))},[n.data,u,d,f]);const E=()=>w.map(s=>{const i=l==="yearly"?s.yearlyPrice:s.monthlyPrice;return{...s,price:i}});o.useEffect(()=>{if(r){let s="starter";r.name===y.MONTHLY?(s="lite",x("monthly")):r.name===y.ANNUAL?(s="lite",x("yearly")):r.name.includes("Premium")&&(s="premium",x(r.name.includes("Annual")?"yearly":"monthly")),u(s)}else u("starter")},[r,x,u]);const Y=E();return t!=null&&t.needsShopParam?e.jsx("div",{className:"bg-gray-100 min-h-screen p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(S,{createButtonText:"Create Pop-Up"}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 text-orange-700 px-4 py-3 rounded mb-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium",children:"Shop Parameter Required"}),e.jsx("p",{className:"text-sm mt-2",children:"Please access this page from your Shopify admin or include the shop parameter in the URL."}),e.jsx("button",{onClick:()=>d("/auth/login"),className:"mt-4 bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition-colors",children:"Go to Login"})]})})]})}):e.jsxs("div",{className:"bg-gray-100 min-h-screen p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(S,{createButtonText:"Create Pop-Up"}),!m&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 text-orange-700 px-4 py-3 rounded mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Authentication Required"}),e.jsx("p",{className:"text-sm",children:"You need to be authenticated to change subscription plans."})]}),e.jsx("button",{onClick:()=>d(`/auth?shop=${f||"your-shop"}`),className:"bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700 transition-colors",children:"Sign In"})]})}),v&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-6",children:[e.jsx("p",{className:"mb-2",children:v}),e.jsx("button",{onClick:()=>p(null),className:"text-red-600 hover:text-red-800 text-sm underline",children:"Dismiss"})]}),P&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-6",children:e.jsx("p",{children:P})}),r&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4 mb-6",children:[e.jsx("h2",{className:"font-semibold text-lg mb-1",children:"Current Subscription"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-gray-700",children:["Plan:"," ",e.jsx("span",{className:"font-medium",children:r.name})]})}),e.jsx("div",{children:e.jsxs("p",{className:"text-gray-700",children:["Status:"," ",e.jsx("span",{className:"font-medium capitalize",children:r.status})]})}),r.trialDays>0&&e.jsx("div",{children:e.jsxs("p",{className:"text-gray-700",children:["Trial:"," ",e.jsxs("span",{className:"font-medium",children:[r.trialDays," days"]})]})}),e.jsx("div",{children:e.jsxs("p",{className:"text-gray-700",children:["Next Billing:"," ",e.jsx("span",{className:"font-medium",children:new Date(r.currentPeriodEnd).toLocaleDateString()})]})})]})]}),!r&&m&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[e.jsx("h2",{className:"font-semibold text-lg mb-1",children:"Current Plan: Free Starter"}),e.jsx("p",{className:"text-gray-700",children:"You're currently on the free Starter plan. Upgrade anytime to unlock more features!"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"PRICING"}),e.jsx("p",{className:"text-gray-600",children:"Start with our free plan or upgrade for more features. Real-time subscription management."})]}),e.jsxs("div",{className:"bg-gray-200 rounded-full p-1 inline-flex mt-4 md:mt-0",children:[e.jsx("button",{className:`${l==="monthly"?"bg-indigo-600 text-white":"text-gray-700"} px-6 py-2 rounded-full font-medium transition-colors`,onClick:()=>C("monthly"),children:"Monthly"}),e.jsx("button",{className:`${l==="yearly"?"bg-indigo-600 text-white":"text-gray-700"} px-6 py-2 rounded-full font-medium transition-colors`,onClick:()=>C("yearly"),children:"Yearly"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Y.map(s=>e.jsxs("div",{className:`bg-white rounded-lg p-8 shadow-sm relative ${s.popular?"border-2 border-indigo-600":""} ${s.id==="starter"?"border-2 border-green-400":""} ${c.id===s.id?"ring-2 ring-blue-500":""}`,children:[s.popular&&e.jsx("div",{className:"absolute -top-4 left-0 right-0 mx-auto w-max bg-indigo-600 text-white px-6 py-2 rounded-lg font-medium",children:"Most Picked"}),s.id==="starter"&&e.jsx("div",{className:"absolute -top-4 left-0 right-0 mx-auto w-max bg-green-600 text-white px-6 py-2 rounded-lg font-medium",children:"Free Forever"}),c.id===s.id&&e.jsx("div",{className:"absolute -top-4 left-0 right-0 mx-auto w-max bg-blue-600 text-white px-6 py-2 rounded-lg font-medium",children:"Current Plan"}),e.jsx("div",{className:"absolute top-8 right-8 bg-indigo-100 p-3 rounded-full",children:s.id==="starter"?e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M13 10V3L4 14H11V21L20 10H13Z",stroke:"#4F46E5",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}):e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M4.5 16.5C3.12 15.78 2.25 14.28 2.25 12.75C2.25 10.41 4.14 8.52 6.48 8.52C6.71 8.52 6.94 8.54 7.17 8.59C7.35 8.63 7.53 8.52 7.59 8.34C8.19 6.45 9.9 5.02 12 5.02C14.1 5.02 15.81 6.45 16.41 8.34C16.47 8.52 16.65 8.63 16.83 8.59C17.06 8.55 17.29 8.52 17.52 8.52C19.86 8.52 21.75 10.41 21.75 12.75C21.75 14.28 20.88 15.78 19.5 16.5",stroke:"#4F46E5",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7.5 16.5V18.75C7.5 19.58 8.17 20.25 9 20.25H15C15.83 20.25 16.5 19.58 16.5 18.75V16.5",stroke:"#4F46E5",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12 16.5V11.25",stroke:"#4F46E5",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9.75 13.5L12 11.25L14.25 13.5",stroke:"#4F46E5",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("h2",{className:"text-xl font-semibold mb-2 mt-4",children:s.name}),e.jsxs("div",{className:"flex items-baseline mb-1",children:[e.jsx("span",{className:"text-4xl font-bold",children:L(s.price)}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:s.price===0?"forever":l==="yearly"?"per year":"per month"})]}),l==="yearly"&&s.yearlyPrice<s.monthlyPrice*12&&s.price>0&&e.jsxs("p",{className:"text-green-600 text-sm font-medium",children:["Save"," ",L(s.monthlyPrice*12-s.yearlyPrice)," ","annually"]}),e.jsx("div",{className:"border-t border-gray-100 my-4"}),e.jsx("ul",{className:"space-y-3 mb-8",children:s.features.map((i,h)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),e.jsx("span",{className:"text-sm",children:i})]},h))}),e.jsx("button",{className:`w-full ${c.id===s.id?"bg-blue-100 text-blue-700 cursor-default":m?s.id==="starter"?"bg-green-600 text-white hover:bg-green-700":"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-300 text-gray-500 cursor-not-allowed"} py-3 px-4 rounded-lg font-medium transition-colors`,onClick:()=>I(s.id),disabled:c.id===s.id||g||!m,children:c.id===s.id?"Current Plan":m?g?"Processing...":s.id==="starter"?"Start Free":"Get Started":"Authentication Required"})]},s.id))}),e.jsxs("div",{className:"mt-16",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Frequently Asked Questions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"How does real-time billing work?"}),e.jsx("p",{className:"text-gray-600",children:"Changes take effect immediately. Free plan has no billing. Paid plans are processed through Shopify's secure billing system."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Can I change my plan anytime?"}),e.jsx("p",{className:"text-gray-600",children:"Yes! You can upgrade, downgrade, or switch to the free plan at any time. Changes are instant."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"What happens when I upgrade?"}),e.jsx("p",{className:"text-gray-600",children:"You'll be redirected to Shopify to confirm billing. Once confirmed, your new features are available immediately."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"How do I cancel?"}),e.jsx("p",{className:"text-gray-600",children:"Simply switch to the free Starter plan anytime. Your subscription will be cancelled automatically."})]})]})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Confirm Plan Change"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Are you sure you want to switch to the"," ",(k=w.find(s=>s.id===a))==null?void 0:k.name," plan",a!=="starter"&&` with ${l} billing`,"?",a==="starter"?e.jsx("span",{className:"block mt-2 text-sm text-green-600",children:"✅ This will switch you to the free plan. No billing required."}):e.jsx("span",{className:"block mt-2 text-sm text-gray-500",children:"💳 You will be redirected to Shopify to complete the billing setup."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors",disabled:g,children:"Cancel"}),e.jsx("button",{onClick:$,className:`px-4 py-2 ${a==="starter"?"bg-green-600 hover:bg-green-700":"bg-indigo-600 hover:bg-indigo-700"} text-white rounded-md transition-colors relative`,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"opacity-0",children:"Confirm"}),e.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]}):"Confirm"})]})]})})]})}export{Z as default};
